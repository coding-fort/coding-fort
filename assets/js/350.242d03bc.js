(window.webpackJsonp=window.webpackJsonp||[]).push([[350],{676:function(t,e,v){"use strict";v.r(e);var _=v(25),s=Object(_.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"csp-content-security-policy-内容安全策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#csp-content-security-policy-内容安全策略"}},[t._v("#")]),t._v(" CSP (Content Security Policy, 内容安全策略)")]),t._v(" "),e("p",[t._v("CSP (Content Security Policy, 内容安全策略) 是一种安全策略机制，用于帮助防范跨站脚本 (XSS) 攻击以及其他代码注入攻击。通过 CSP，网站可以定义哪些来源的内容是可以信任和加载的，从而限制了攻击者能够注入恶意内容的机会。")]),t._v(" "),e("h3",{attrs:{id:"csp-的工作原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#csp-的工作原理"}},[t._v("#")]),t._v(" CSP 的工作原理")]),t._v(" "),e("p",[t._v("CSP 是通过 HTTP 响应头来实现的，允许开发者指定哪些资源可以从哪里加载，以及如何加载。当浏览器解析文档时，它会检查这些策略，并阻止那些不符合策略规定的资源加载或执行。")]),t._v(" "),e("h3",{attrs:{id:"基本-csp-指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基本-csp-指令"}},[t._v("#")]),t._v(" 基本 CSP 指令")]),t._v(" "),e("p",[t._v("CSP 定义了一系列指令，每个指令控制着特定类型的资源加载行为。一些常见的指令包括：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("default-src")]),t._v(": 设置默认的来源策略，适用于所有其他指令未覆盖的资源类型。")]),t._v(" "),e("li",[e("code",[t._v("script-src")]),t._v(": 控制哪些来源的 JavaScript 可以执行。")]),t._v(" "),e("li",[e("code",[t._v("connect-src")]),t._v(": 控制哪些来源的 XMLHttpRequest 和 Fetch 请求可以发出。")]),t._v(" "),e("li",[e("code",[t._v("img-src")]),t._v(": 控制哪些来源的图像可以加载。")]),t._v(" "),e("li",[e("code",[t._v("style-src")]),t._v(": 控制哪些来源的 CSS 可以加载。")]),t._v(" "),e("li",[e("code",[t._v("font-src")]),t._v(": 控制哪些来源的字体文件可以加载。")]),t._v(" "),e("li",[e("code",[t._v("object-src")]),t._v(": 控制哪些来源的对象（如 Flash 对象）可以加载。")]),t._v(" "),e("li",[e("code",[t._v("frame-src")]),t._v(": 控制哪些来源的 "),e("code",[t._v("<iframe>")]),t._v(" 可以加载。")]),t._v(" "),e("li",[e("code",[t._v("base-uri")]),t._v(": 控制哪些来源的 "),e("code",[t._v("<base>")]),t._v(" 标签可以设置。")]),t._v(" "),e("li",[e("code",[t._v("form-action")]),t._v(": 控制哪些来源的表单提交是允许的。")])]),t._v(" "),e("h3",{attrs:{id:"指定来源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#指定来源"}},[t._v("#")]),t._v(" 指定来源")]),t._v(" "),e("p",[t._v("CSP 允许使用几种方式来指定来源：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("'self'")]),t._v(": 表示同一源策略。")]),t._v(" "),e("li",[e("code",[t._v("'unsafe-inline'")]),t._v(": 允许内联脚本和样式（不推荐，因为它可能会引入 XSS 风险）。")]),t._v(" "),e("li",[e("code",[t._v("'unsafe-eval'")]),t._v(": 允许使用 "),e("code",[t._v("eval()")]),t._v(" 和内联事件处理程序（同样不推荐）。")]),t._v(" "),e("li",[e("code",[t._v("'nonce-'")]),t._v(": 用于标记内联脚本或样式，需要配合一个随机数（nonce）使用。")]),t._v(" "),e("li",[e("code",[t._v("'hash-'")]),t._v(": 用于基于哈希值的内联脚本或样式，需要计算内联脚本或样式的哈希值。")]),t._v(" "),e("li",[t._v("域名、IP 地址或 URL: 明确指定来源。")])]),t._v(" "),e("h3",{attrs:{id:"示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),e("p",[t._v("下面是一个简单的 CSP 头部示例，只允许从当前站点加载脚本和样式，并允许从 "),e("code",[t._v("example.com")]),t._v(" 加载图片：")]),t._v(" "),e("div",{staticClass:"language-http line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-http"}},[e("code",[e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Security-Policy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token header-value csp languages-csp"}},[t._v("default-src 'self'; img-src 'self' example.com; script-src 'self'; style-src 'self'")])]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h3",{attrs:{id:"报告机制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#报告机制"}},[t._v("#")]),t._v(" 报告机制")]),t._v(" "),e("p",[t._v("CSP 还支持报告模式 ("),e("code",[t._v("report-uri")]),t._v(" 或 "),e("code",[t._v("report-to")]),t._v(")，即使违反了策略也不会阻止资源加载，而是将违规情况发送给指定的端点供分析。")]),t._v(" "),e("h3",{attrs:{id:"实施-csp-的步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实施-csp-的步骤"}},[t._v("#")]),t._v(" 实施 CSP 的步骤")]),t._v(" "),e("ol",[e("li",[e("strong",[t._v("评估现有的网页")]),t._v("：确定哪些资源是必要的，并记录它们的来源。")]),t._v(" "),e("li",[e("strong",[t._v("制定 CSP 策略")]),t._v("：基于第一步的信息，制定合适的 CSP 指令。")]),t._v(" "),e("li",[e("strong",[t._v("测试 CSP 策略")]),t._v("：使用 "),e("code",[t._v("Content-Security-Policy-Report-Only")]),t._v(" 头部进行测试，确保没有误报。")]),t._v(" "),e("li",[e("strong",[t._v("部署 CSP")]),t._v("：一旦测试无误，将 "),e("code",[t._v("Content-Security-Policy-Report-Only")]),t._v(" 更改为 "),e("code",[t._v("Content-Security-Policy")]),t._v("。")]),t._v(" "),e("li",[e("strong",[t._v("监控和调整")]),t._v("：持续监控 CSP 报告，必要时调整策略。")])]),t._v(" "),e("h3",{attrs:{id:"注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),e("ul",[e("li",[t._v("在部署 CSP 之前，一定要彻底测试以避免意外地阻止合法内容。")]),t._v(" "),e("li",[t._v("使用报告模式可以帮助调试和理解哪些资源会被阻止。")]),t._v(" "),e("li",[t._v("为了更精细的控制，可以使用更多的 CSP 指令。")])]),t._v(" "),e("p",[t._v("通过正确配置 CSP，可以显著提高网站的安全性，减少被恶意攻击的可能性。")])])}),[],!1,null,null,null);e.default=s.exports}}]);